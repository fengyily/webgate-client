
<guac-viewport>

    <!-- Client view -->
    <div class="client-view">
        <div class="client-view-content">

            <!-- Central portion of view -->
            <div class="client-body" guac-touch-drag="menuDrag">

                <!-- All connections in current display -->
                <guac-tiled-clients
                    on-close="closeClientTile($client)"
                    client-group="clientGroup"
                    emulate-absolute-mouse="menu.emulateAbsoluteMouse">
                </guac-tiled-clients>

            </div>

            <!-- Bottom portion of view -->
            <div class="client-bottom">

                <!-- Text input -->
                <div class="text-input-container" ng-if="showTextInput">
                    <guac-text-input></guac-text-input>
                </div>

                <!-- On-screen keyboard -->
                <div class="keyboard-container" ng-if="showOSK">
                    <guac-osk layout="'CLIENT.URL_OSK_LAYOUT' | translate"></guac-osk>
                </div>

            </div>

        </div>
    </div>

    <!-- File transfers -->
    <div id="file-transfer-dialog" ng-show="hasTransfers()">
        <guac-file-transfer-manager client-group="clientGroup"></guac-file-transfer-manager>
    </div>

    <!-- Connection stability warning -->
    <div id="connection-warning" ng-show="isConnectionUnstable()">
        {{'CLIENT.TEXT_CLIENT_STATUS_UNSTABLE' | translate}}
    </div>
    
    <!-- Menu overlay - click to close menu and apply changes -->
    <div class="menu-overlay" ng-show="menu.shown" ng-click="closeMenu()"></div>

    <!-- Menu -->
    <div class="menu" ng-class="{open: menu.shown}" id="guac-menu">
        <!-- Menu toggle handle - always visible for expanding menu -->
        <div class="menu-handle" ng-click="menu.shown = !menu.shown"></div>
        
        <div class="menu-content" ng-if="menu.shown" guac-touch-drag="menuDrag">

            <!-- Stationary header -->
            <div class="header">
                <h2 ng-hide="rootConnectionGroups">{{ getName(clientGroup) }}</h2>
                <h2 class="connection-select-menu" ng-show="rootConnectionGroups">
                    <guac-menu menu-title="getName(clientGroup)" interactive="true">
                        <div class="all-connections">
                            <guac-group-list-filter connection-groups="rootConnectionGroups"
                                filtered-connection-groups="filteredRootConnectionGroups"
                                placeholder="'CLIENT.FIELD_PLACEHOLDER_FILTER' | translate"
                                connection-properties="filteredConnectionProperties"
                                connection-group-properties="filteredConnectionGroupProperties"></guac-group-list-filter>
                            <guac-group-list
                                connection-groups="filteredRootConnectionGroups"
                                context="connectionListContext"
                                templates="{
                                    'connection'       : 'app/client/templates/connection.html',
                                    'connection-group' : 'app/client/templates/connectionGroup.html'
                                }"
                                page-size="10"></guac-group-list>
                        </div>
                    </guac-menu>
                </h2>
                <div class="share-menu" ng-show="canShareConnection()">
                    <guac-menu menu-title="'CLIENT.ACTION_SHARE' | translate">
                        <ul ng-repeat="sharingProfile in sharingProfiles">
                            <li><a ng-click="share(sharingProfile)">{{sharingProfile.name}}</a></li>
                        </ul>
                    </guac-menu>
                </div>
                <!-- Quick action buttons: Collapse (gray) | Fullscreen (blue) | Disconnect (red) -->
                <div class="header-actions">
                    <button class="action-btn collapse-btn" ng-click="menu.shown = false" title="{{'CLIENT.ACTION_COLLAPSE_MENU' | translate}}">
                        <img class="action-icon" src="images/arrows/left.svg" alt="">
                    </button>
                    <button class="action-btn fullscreen-btn" ng-click="toggleFullscreen()" title="{{'CLIENT.ACTION_FULLSCREEN' | translate}}">
                        <img class="action-icon" src="images/fullscreen.svg" alt="">
                    </button>
                    <button class="action-btn disconnect-btn" ng-click="confirmDisconnect()" title="{{'CLIENT.ACTION_DISCONNECT' | translate}}">
                        <img class="action-icon" src="images/action-icons/guac-logout.svg" alt="">
                    </button>
                </div>
            </div>

            <!-- Scrollable body -->
            <div class="menu-body" guac-touch-drag="visibleMenuDrag" guac-scroll="menu.scrollState">

                <!-- Connection sharing (hidden when not shared) -->
                <div class="menu-section" id="share-links" ng-show="isShared()">
                    <h3 class="section-title">{{'CLIENT.INFO_CONNECTION_SHARED' | translate}}</h3>
                    <div class="section-content">
                        <p class="description"
                           translate="CLIENT.HELP_SHARE_LINK"
                           translate-values="{LINKS : getShareLinkCount()}"></p>
                        <table>
                            <tr ng-repeat="link in focusedClient.shareLinks | toArray | orderBy: value.name">
                                <th>{{link.value.name}}</th>
                                <td><a href="{{link.value.href}}" target="_blank">{{link.value.href}}</a></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- File Manager -->
                <div class="menu-section" id="sftp-section" ng-if="focusedClient.filesystems.length">
                    <h3 class="section-title">{{'CLIENT.SECTION_HEADER_SFTP' | translate}}</h3>
                    <div class="section-content">
                        <div class="sftp-item" ng-repeat="filesystem in focusedClient.filesystems" ng-click="showFilesystemMenu(filesystem)">
                            <span class="sftp-icon">üìÅ</span> {{filesystem.name}}
                        </div>
                    </div>
                </div>

                <!-- Connection parameters: Color Scheme, Font Name -->
                <div class="menu-section connection-parameters" id="connection-settings" ng-if="focusedClient.protocol">
                    <guac-form namespace="getProtocolNamespace(focusedClient.protocol)"
                               content="focusedClient.forms"
                               model="menu.connectionParameters"
                               client="focusedClient"
                               model-only="true"></guac-form>
                </div>

                <!-- Font Size -->
                <div class="menu-section" id="font-size-section" ng-if="menu.connectionParameters['font-size'] !== undefined">
                    <h3 class="section-title">{{'PROTOCOL_SSH.FIELD_HEADER_FONT_SIZE' | translate}}</h3>
                    <div class="section-content">
                        <div class="btn-group">
                            <button class="setting-btn" ng-class="{'active': menu.connectionParameters['font-size'] === '10'}" 
                                    ng-click="menu.connectionParameters['font-size'] = '10'">{{'PROTOCOL_SSH.FIELD_OPTION_FONT_SIZE_10' | translate}}</button>
                            <button class="setting-btn" ng-class="{'active': menu.connectionParameters['font-size'] === '12' || menu.connectionParameters['font-size'] === ''}" 
                                    ng-click="menu.connectionParameters['font-size'] = '12'">{{'PROTOCOL_SSH.FIELD_OPTION_FONT_SIZE_12' | translate}}</button>
                            <button class="setting-btn" ng-class="{'active': menu.connectionParameters['font-size'] === '14'}" 
                                    ng-click="menu.connectionParameters['font-size'] = '14'">{{'PROTOCOL_SSH.FIELD_OPTION_FONT_SIZE_14' | translate}}</button>
                            <button class="setting-btn" ng-class="{'active': menu.connectionParameters['font-size'] === '18'}" 
                                    ng-click="menu.connectionParameters['font-size'] = '18'">{{'PROTOCOL_SSH.FIELD_OPTION_FONT_SIZE_18' | translate}}</button>
                            <button class="setting-btn" ng-class="{'active': menu.connectionParameters['font-size'] === '24'}" 
                                    ng-click="menu.connectionParameters['font-size'] = '24'">{{'PROTOCOL_SSH.FIELD_OPTION_FONT_SIZE_24' | translate}}</button>
                        </div>
                    </div>
                </div>

                <!-- Input Method -->
                <div class="menu-section" id="input-settings">
                    <h3 class="section-title">{{'CLIENT.SECTION_HEADER_INPUT_METHOD' | translate}}</h3>
                    <div class="section-content">
                        <div class="btn-group">
                            <button class="setting-btn" 
                                    ng-class="{'active': menu.inputMethod === 'none'}"
                                    ng-click="menu.inputMethod = 'none'"
                                    title="{{'CLIENT.HELP_INPUT_METHOD_NONE' | translate}}">
                                {{'CLIENT.NAME_INPUT_METHOD_NONE' | translate}}
                            </button>
                            <button class="setting-btn"
                                    ng-class="{'active': menu.inputMethod === 'text'}"
                                    ng-click="menu.inputMethod = 'text'"
                                    title="{{'CLIENT.HELP_INPUT_METHOD_TEXT' | translate}}">
                                {{'CLIENT.NAME_INPUT_METHOD_TEXT' | translate}}
                            </button>
                            <button class="setting-btn"
                                    ng-class="{'active': menu.inputMethod === 'osk'}"
                                    ng-click="menu.inputMethod = 'osk'"
                                    title="{{'CLIENT.HELP_INPUT_METHOD_OSK' | translate}}">
                                {{'CLIENT.NAME_INPUT_METHOD_OSK' | translate}}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Mouse Emulation Mode -->
                <div class="menu-section" id="mouse-settings">
                    <h3 class="section-title">{{'CLIENT.SECTION_HEADER_MOUSE_MODE' | translate}}</h3>
                    <div class="section-content">
                        <div class="btn-group">
                            <button class="setting-btn"
                                    ng-class="{'active': menu.emulateAbsoluteMouse === true}"
                                    ng-click="menu.emulateAbsoluteMouse = true"
                                    title="{{'CLIENT.HELP_MOUSE_MODE_ABSOLUTE' | translate}}">
                                {{'CLIENT.NAME_MOUSE_MODE_ABSOLUTE' | translate}}
                            </button>
                            <button class="setting-btn"
                                    ng-class="{'active': menu.emulateAbsoluteMouse === false}"
                                    ng-click="menu.emulateAbsoluteMouse = false"
                                    title="{{'CLIENT.HELP_MOUSE_MODE_RELATIVE' | translate}}">
                                {{'CLIENT.NAME_MOUSE_MODE_RELATIVE' | translate}}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Zoom -->
                <div class="menu-section" id="zoom-settings" ng-if="focusedClient">
                    <h3 class="section-title">{{'CLIENT.SECTION_HEADER_ZOOM' | translate}}</h3>
                    <div class="section-content">
                        <div class="zoom-controls">
                            <button class="zoom-btn" ng-click="focusedClient.clientProperties.autoFit = false; focusedClient.clientProperties.scale = focusedClient.clientProperties.scale - 0.1" title="{{'CLIENT.TEXT_ZOOM_OUT' | translate}}">‚àí</button>
                            <span class="zoom-value">{{(focusedClient.clientProperties.scale * 100) | number:0}}%</span>
                            <button class="zoom-btn" ng-click="focusedClient.clientProperties.autoFit = false; focusedClient.clientProperties.scale = focusedClient.clientProperties.scale + 0.1" title="{{'CLIENT.TEXT_ZOOM_IN' | translate}}">+</button>
                            <label class="autofit-checkbox">
                                <input type="checkbox" ng-model="focusedClient.clientProperties.autoFit">
                                {{'CLIENT.TEXT_ZOOM_AUTO_FIT' | translate}}
                            </label>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <!-- Filesystem menu -->
    <div id="filesystem-menu" class="menu" ng-class="{open: isFilesystemMenuShown()}">
        <div class="menu-content">

            <!-- Stationary header -->
            <div class="header">
                <h2>{{filesystemMenuContents.name}}</h2>
                <button class="upload button" guac-upload="uploadFiles">{{'CLIENT.ACTION_UPLOAD_FILES' | translate}}</button>
                <button class="back" ng-click="hideFilesystemMenu()">{{'CLIENT.ACTION_NAVIGATE_BACK' | translate}}</button>
            </div>

            <!-- Breadcrumbs -->
            <div class="header breadcrumbs"><div
                    class="breadcrumb root"
                    ng-click="changeDirectory(filesystemMenuContents, filesystemMenuContents.root)"></div><div
                        class="breadcrumb"
                        ng-repeat="file in getPath(filesystemMenuContents.currentDirectory)"
                        ng-click="changeDirectory(filesystemMenuContents, file)">{{file.name}}</div>
            </div>

            <!-- Scrollable body -->
            <div class="menu-body">
                <guac-file-browser client="client" filesystem="filesystemMenuContents"></guac-file-browser>
            </div>

        </div>
    </div>

</guac-viewport>
